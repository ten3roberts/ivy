<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Ivy User&#x27;s Guide</title>
        <meta name="robots" content="noindex" />
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="introduction.html">Introduction</a></li><li class="chapter-item expanded "><a href="compiling.html"><strong aria-hidden="true">1.</strong> Compiling</a></li><li class="chapter-item expanded "><a href="fundamentals.html"><strong aria-hidden="true">2.</strong> Fundamentals</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="fundamentals/layers.html"><strong aria-hidden="true">2.1.</strong> Layers</a></li><li class="chapter-item expanded "><a href="fundamentals/events.html"><strong aria-hidden="true">2.2.</strong> Events</a></li><li class="chapter-item expanded "><a href="fundamentals/resources.html"><strong aria-hidden="true">2.3.</strong> Resources</a></li><li class="chapter-item expanded "><a href="fundamentals/ecs.html"><strong aria-hidden="true">2.4.</strong> Entity Component System</a></li><li class="chapter-item expanded "><a href="fundamentals/bundles.html"><strong aria-hidden="true">2.5.</strong> Bundles</a></li><li class="chapter-item expanded "><a href="fundamentals/rendering.html"><strong aria-hidden="true">2.6.</strong> Rendering and Passes</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Ivy User&#x27;s Guide</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="welcome-to-ivy"><a class="header" href="#welcome-to-ivy">Welcome to Ivy</a></h1>
<p>Ivy is a modular game engine for data driven Rust game development using Vulkan.</p>
<p>This guide will aim to familiarize the user with the workings of the Ivy game
engine.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="compiling"><a class="header" href="#compiling">Compiling</a></h1>
<p>The best method of incorporating Ivy into a project is either by [crates.io] or
as a submodule.</p>
<p>In addition to registered crates Ivy depends on additional system level
libraries.</p>
<p>For a successful compilation the following dependencies need to be met:</p>
<ul>
<li>Vulkan Development Files</li>
<li>Windowing libraries (X11/Wayland/WINAPI)</li>
<li>Vulkan validation layers for debug builds</li>
</ul>
<h2 id="linux"><a class="header" href="#linux">Linux</a></h2>
<p>For compilation of glfw the following libraries need to be present:</p>
<ul>
<li>libxi-dev</li>
<li>libxcursor-dev</li>
<li>libxinerama-dev</li>
<li>libxrandr-dev</li>
<li>libx11-dev</li>
</ul>
<h3 id="fedora"><a class="header" href="#fedora">Fedora</a></h3>
<pre><code class="language-sh">sudo dnf install libXi-devel libXcursor-devel libXinerama-devel libXrandr-devel
libX11-devel mesa-vulkan-devel vulkan-validation-layers glslc
</code></pre>
<h3 id="debian"><a class="header" href="#debian">Debian</a></h3>
<pre><code class="language-sh">sudo apt install libxi-dev libxcursor-dev libxinerama-dev libXrandr-devel
libx11-dev libvulkan-dev
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="fundamentals"><a class="header" href="#fundamentals">Fundamentals</a></h1>
<p>This chapter will familiarize the reader with the fundamentals of the engine and
what is needed to create a game and start your journey.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="layers"><a class="header" href="#layers">Layers</a></h1>
<p>The core of the program is an application, which defines the update loop.</p>
<p>The update loop dispatches to several layers, which which are <em>mostly</em> self
contained units of logic. The layers get exlusive access to the world,
resources, and events and may execute any logic in <code>on_update</code>. They also get
exclusive access to <code>self</code> which enables them to both read and modify their own
state.</p>
<p>This is useful for games where the main game logic can be contained in one or
more layers and store the state without interfering with other layers such as
physics.</p>
<p>The layered design allows several high level concepts to work together in unison
and separately and allows for logic to be added or removed.</p>
<p>An example would be a game which makes use of a client and server. The binaries
can share most of the code, and the client and server can be separated into
separate layers which allows the client to use all the same game logic as the
server, and vice versa. The server and client layers can also be present at the
same time which allows a self hosted client.</p>
<p>The <code>on_update</code> function takes three parameters:</p>
<ul>
<li><a href="fundamentals/./ecs.html">World</a></li>
<li><a href="fundamentals/./resources.html">Resources</a></li>
<li><a href="fundamentals/./events.html">Events</a></li>
</ul>
<p>The return type is of <code>anyhow::Result</code> and allows for any error to be
propogated.</p>
<p>For a layer to be used it needs to be pushed into the App.</p>
<h2 id="example-usage"><a class="header" href="#example-usage">Example Usage</a></h2>
<p>The layer is a trait which must define an <code>on_update</code> function</p>
<p>The following examples shows the basic usage of a layer, as well how to create
an application using the layer.</p>
<pre><pre class="playground"><code class="language-rust">use ivy_engine::{App, Layer, Logger};
use log::{error, info};

/// Define the game layer
struct GameLayer {}

impl GameLayer {
    fn new() -&gt; Self {
        Self {}
    }
}

impl Layer for GameLayer {
    fn on_update(
        &amp;mut self,
        _: &amp;mut hecs::World,
        _: &amp;mut ivy_engine::Resources,
        _: &amp;mut ivy_base::Events,
        _: std::time::Duration,
    ) -&gt; anyhow::Result&lt;()&gt; {
        info!(&quot;Hello, World!&quot;);
        Ok(())
    }
}

fn main() -&gt; anyhow::Result&lt;()&gt; {
    // Install a default logger
    Logger::default().install();

    // Create a simple app
    let result = App::builder()
        .push_layer(|_, _, _| GameLayer::new())
        .build()
        .run();

    // Pretty print results
    match &amp;result {
        Ok(()) =&gt; {}
        Err(val) =&gt; error!(&quot;Error: {}&quot;, val),
    }

    result
}
</code></pre></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="events"><a class="header" href="#events">Events</a></h1>
<p>To facilitate intra and interlayer communication a deferred bus like event
system is provided.</p>
<p>Any user can subscribe to an event by using a channel. Every layer of type <code>T</code>
will be broadcaasted to every subscribed sender. The event can thereafter be
read by iterating the receiving half.</p>
<p>By default, <a href="https://doc.rust-lang.org/std/sync/mpsc/index.html">std::mpsc::channel</a>, <a href="https://docs.rs/flume">flume</a>, and <a href="https://docs.rs/crossbeam-channel/0.5.1/crossbeam_channel/">crossbeam-channel</a> <em>(feature = &quot;crossbeam-channel&quot;)</em> implement the <code>EventSender</code> trait.</p>
<p>The events will not be cleared between different frames but rather consumed when
iterated. This allows layers which execute occasionally to not miss any events.</p>
<p>Any <code>'static</code> <code>Send</code> + <code>Sync</code> + <code>Clone</code> type can be used as an event. However, if
cloning is expensive, consider wrapping the event in an <code>Arc</code> or referring to it
by other means as the event will be cloned for every subscribed sender.</p>
<h2 id="example"><a class="header" href="#example">Example</a></h2>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn events() {
    #[derive(Debug, Clone, PartialEq, Eq)]
    pub struct MyEvent(String);
    #[derive(Debug, Clone, PartialEq, Eq)]
    pub struct OtherEvent(String);

    // Normally, events will be supplied by App
    let mut events = Events::new();
    let my_events = events.subscribe::&lt;MyEvent&gt;();

    let other_events = events.subscribe::&lt;OtherEvent&gt;();

    // Send some events
    events.send(MyEvent(String::from(&quot;Hello, World!&quot;)));

    // Receive events
    for event in my_events.try_iter() {
        let other = OtherEvent(event.0.to_uppercase());
        events.send(other)
    }

    assert!(other_events
        .try_iter()
        .map(|val| val.0)
<span class="boring">}
</span></code></pre></pre>
<h2 id="intercepting"><a class="header" href="#intercepting">Intercepting</a></h2>
<p>Sometimes it is necessary to intercept events, either absorbing them or
re-emitting them. This can be accomplished in two main ways.</p>
<p>Events of a certain type can be sent and consumed, to then be resent using a
different type. The final consumers should then subscribe to the latter type.</p>
<p>Sometimes however, it is not possible to re-emit events; either because of
already existing architecture, or that the intercepting component may not always
be present and thus requiring a <em>mockup</em> intercepter that simply re-emits.</p>
<p>For these use cases, the use of the <code>intercept</code> API is necessary.</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn intercept_events() {
    #[derive(Debug, Clone, PartialEq, Eq)]
    pub struct MyEvent(String);

    // Normally, events will be supplied by App
    let mut events = Events::new();
    let (tx, my_events) = flume::unbounded();
    events.intercept::&lt;MyEvent, _&gt;(tx).unwrap();

    let other_events = events.subscribe::&lt;MyEvent&gt;();

    // Send some events
    events.send(MyEvent(String::from(&quot;Hello, World!&quot;)));

    // Receive events
    for event in my_events.try_iter() {
        let other = MyEvent(event.0.to_uppercase());
        events.intercepted_send(other)
    }

    assert!(other_events
        .try_iter()
        .map(|val| val.0)
<span class="boring">}
</span></code></pre></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="resources"><a class="header" href="#resources">Resources</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="entity-component-system"><a class="header" href="#entity-component-system">Entity Component System</a></h1>
<p>The logic of the library is centered around the Entity Component System
design pattern.</p>
<p>In short, the ECS pattern describes entities as a collection of components. The
principle is tightly coupled with data driven development.</p>
<p>Ivy makes use of <a href="https://github.com/ralith/hecs">hecs</a> for the ecs, with the
extension libraries <a href="https://github.com/ten3roberts/hecs-hierarchy">hecs-hierarchy</a> for declaring relationships between entities, and <a href="https://github.com/ten3roberts/hecs-schedule">hecs-schedule</a> for system execution abstractions, borrowing, and automatic multithreading.</p>
<p>Behaviors are controlled by the components attached to an entity.</p>
<p><a href="https://docs.rs/hecs-schedule/0.3.21/hecs_schedule/#system-and-schedule">Systems</a> declared in schedules then query and operate on the entities and can
modify state.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="bundles"><a class="header" href="#bundles">Bundles</a></h1>
<p>Many of the built in systems require a certain set of components to be present
in order to avoid many <code>Option</code> in query and branches.</p>
<p>For example, rendering requires <code>Position</code>, <code>Rotation</code>, <code>Scale</code>, <code>Mesh</code>,
<code>Visible</code>, <code>Color</code>, <code>Pass</code>. Remembering to add all these when spawning entities
is a chore, and makes it easy to forget some and not having the entity show up.</p>
<p>To fix this several bundles are provided, which has the added benefit of
providing sane defaults.</p>
<p>The following snippet shows how to create a new entity which will be moving in
the world with an initial velocity.</p>
<p><strong>Note</strong>: The entity won't be rendered, since no rendergraph has been setup,
and the entity does not have the <code>ObjectBundle</code> bundle. It is recommended to
use a custom layer and creating the entities in <code>new</code> or a <code>setup</code> function.
However, the raw usage of <code>App</code> is used for brevity.</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>    let mut app = App::builder().build();

    let world = app.world_mut();

    let entity = EntityBuilder::new()
        .add_bundle(RbBundle {
            vel: Velocity::new(1.0, 0.0, 0.0),
            mass: Mass(5.0),
            ang_mass: AngularMass(2.0),
            ..Default::default()
        })
        .add(Name::new(&quot;My Entity&quot;))
        .spawn(world);

    // Get the `Resitution` component
    assert_eq!(
        *world.get::&lt;Resitution&gt;(entity).unwrap(),
        Resitution::default()
    );
<span class="boring">}
</span></code></pre></pre>
<h2 id="bundles-1"><a class="header" href="#bundles-1">Bundles</a></h2>
<p>The following bundles are provided:</p>
<ul>
<li><code>ObjectBundle</code> - Renderable objects with position and mesh</li>
<li><code>RbBundle</code> - Rigidbody obejct</li>
<li><code>RbColliderBundle</code> - Rigidbody object with a collider</li>
<li><code>WidgetBundle</code> - Base UI element, similar to html <code>div</code></li>
<li><code>TextBundle</code> - UI text element</li>
<li><code>ImageBundle</code> - UI image element</li>
<li><code>ConnectionBundle</code> - Declare physical relationships between entities</li>
<li><code>TransformBundle</code> - Position an object with Position, Rotation, and Scale. A
matching <code>TransformQuery</code> and <code>.into_matrix()</code> are provided as well.</li>
<li><code>ConstraintBundle</code> - UI constraints bundle, part of <code>WidgetBundle</code></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rendering-and-passes"><a class="header" href="#rendering-and-passes">Rendering and Passes</a></h1>
<h2 id="shaderpass"><a class="header" href="#shaderpass">Shaderpass</a></h2>
<p>Compared to other game engines, Ivy uses a slightly more complicated, though more
flexible approach to rendering.</p>
<p>All rendereable entities, hereby referred to as <em>objects</em> have an associated
shaderpass. A shaderpass holds a shader and describes at which point it will be rendered
in the rendering pipelines.</p>
<p>Each node in the rendering shaderpass has an associated type of shaderpass which it will
render. For example, the <code>ImageRenderer</code> will usually be set up to render
objects which have a <code>Handle&lt;ImagePass&gt;</code>. The <code>ImagePass</code>, wrapped in an opaque
resource handle, will describe the vulkan pipeline and layout used.</p>
<p><strong>Note</strong>: The renderer usually expect the different shaderpasses to conform to
a single pipeline layout due to descriptor binding.</p>
<p>Objects with meshes usually have a <code>GeometryPass</code> attached to them, with the
mesh and/or material describing the specific properties like texture and
roughness.</p>
<p>Different objects which belong to the same shaderpass can have different values, I.e;
different shaders, which for example can be used for wind affected foliage to be
rendered along other objects in the same shaderpass, but different shaders.</p>
<p>The system also allows for multiple shaderpasses to be attached to the same entity,
allowing the entity to use different shaders for different shaderpasses. This high
customizability allows the same entity to use a textured albedo shader for
<code>GeometryPass</code>, and a solid color for a hypothetical <code>MinimapPass</code>. This can be
very useful in games where the same object may be required to be rendered
multiple times from different viewpoints.</p>
<p>A <code>ShaderPass</code> is a type which wraps a <code>Pipeline</code> and a <code>PipelineLayout</code>, though
they can contain other info. The Rust type system is used for differentiating
between different kinds of passes.</p>
<p>For reducing boilerplate a convenience macro <code>new_shaderpass</code> is provided for
easily creating one or more stronly typed shaderpass types.</p>
<p>Example:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use ivy::new_shaderpass;


new_shaderpass! {
  pub struct MinimapPass;
  pub struct SolidPass;
}
<span class="boring">}
</span></code></pre></pre>
<p>In many cases though, the usage of the included <code>GeometryPass</code>, <code>ImagePass</code>,
<code>TextPass</code>, and different post processing passes are enough.</p>
<h2 id="rendergraph"><a class="header" href="#rendergraph">Rendergraph</a></h2>
<p>The rendering graph describes an acyclic graph of rendering nodes, which
describe how the scene will be rendered. Each node describes its inputs and
outputs, and dependencies will automatically be generated to ensure proper
ordering and syncronization with paralellization using Vulkan.</p>
<p><code>ivy-presets</code> contain common rendergraph setups, such as for PBR rendering. It
is also possible to create your own rendergraph to tailor the rendering for your
game or application.</p>
<p>The following example shows the raw, unaided setup of a rendergraph rendering a
simple unlit model to the screen.</p>
<pre><pre class="playground"><code class="language-rust">use base::{BuilderExt, Events};
use glam::Vec3;
use graphics::{
    shaders::{FORWARD_FRAGMENT_SHADER, FORWARD_VERTEX_SHADER},
    NodeBuildInfo,
};
use hecs::{EntityBuilder, World};
use ivy_engine::*;
use physics::PhysicsLayer;
use presets::GeometryPass;
use rendergraph::{AttachmentInfo, CameraNode, CameraNodeInfo, GraphicsLayer, SwapchainNode};
use resources::LoadResource;
use vulkan::{
    context::SharedVulkanContext,
    vk::{ClearValue, PresentModeKHR},
    ClearValueExt, PipelineInfo, SwapchainInfo, TextureInfo,
};
pub struct GameLayer {}

const FRAMES_IN_FLIGHT: usize = 2;
impl GameLayer {
    pub fn new(
        world: &amp;mut World,
        resources: &amp;mut Resources,
        _: &amp;mut Events,
    ) -&gt; anyhow::Result&lt;Self&gt; {
        Self::setup(world, resources)?;
        Ok(Self {})
    }

    pub fn setup(world: &amp;mut World, resources: &amp;mut Resources) -&gt; anyhow::Result&lt;()&gt; {
        let window = resources.get_default::&lt;Window&gt;()?;

        // Create a camera
        let camera = EntityBuilder::new()
            .add_bundle((
                Camera::perspective(1.0, window.aspect(), 0.1, 100.0),
                MainCamera,
            ))
            .add_bundle(TransformBundle {
                pos: Position::new(0.0, 0.0, -3.0),
                ..Default::default()
            })
            .spawn(world);

        let context = resources.get_default::&lt;SharedVulkanContext&gt;()?;

        // Create or get existing rendergraph
        let mut rendergraph = resources
            .default_entry()?
            .or_try_insert_with(|| RenderGraph::new(context.clone(), FRAMES_IN_FLIGHT))?;

        // Create a texture to render into
        let color = resources.insert(Texture::new(
            context.clone(),
            &amp;TextureInfo {
                extent: window.extent(),
                usage: ImageUsage::COLOR_ATTACHMENT
                    | ImageUsage::TRANSFER_SRC
                    | ImageUsage::SAMPLED,
                ..Default::default()
            },
        )?)?;

        // Create a depth buffer to ensure proper ordering
        let depth = resources.insert(Texture::new(
            context.clone(),
            &amp;TextureInfo::depth(window.extent()),
        )?)?;

        // Get or create a mesh renderer
        let renderer = resources
            .default_entry::&lt;MeshRenderer&gt;()?
            .or_try_insert_with(|| MeshRenderer::new(context.clone(), 128, FRAMES_IN_FLIGHT))?
            .handle;

        // Add a node rendering the scene from the camera
        rendergraph.add_node(CameraNode::&lt;GeometryPass, _&gt;::new(
            context.clone(),
            resources,
            camera,
            renderer,
            CameraNodeInfo {
                color_attachments: vec![AttachmentInfo::color(color)],
                depth_attachment: Some(AttachmentInfo::depth_discard(depth)),
                clear_values: vec![
                    ClearValue::color(0.0, 0.0, 0.0, 0.0),
                    ClearValue::depth_stencil(1.0, 0),
                ],
                ..Default::default()
            },
        )?);

        // Add a node to present the texture to the swapchain and window
        rendergraph.add_node(SwapchainNode::new(
            context.clone(),
            &amp;resources,
            resources.default()?,
            color,
        )?);

        rendergraph.build(resources.fetch()?, window.extent())?;

        // Create a simple pipeline
        let pipeline = GeometryPass(PipelineInfo {
            vs: FORWARD_VERTEX_SHADER,
            fs: FORWARD_FRAGMENT_SHADER,
            ..Default::default()
        });

        let pass = resources.insert(pipeline)?;

        let document = Document::load(resources, &amp;&quot;./res/models/monkey.gltf&quot;.into())?;

        let mut builder = EntityBuilder::new();
        document
            .find(&quot;Suzanne&quot;)?
            .build(
                &amp;mut builder,
                &amp;NodeBuildInfo {
                    skinned: false,
                    animated: false,
                    light_radius: 0.1,
                },
            )
            .add(pass)
            .add_bundle(RbBundle {
                ang_vel: AngularVelocity::new(0.0, 1.0, 0.0),
                ..Default::default()
            })
            .spawn(world);

        Ok(())
    }
}

impl Layer for GameLayer {
    fn on_update(
        &amp;mut self,
        _: &amp;mut hecs::World,
        _: &amp;mut Resources,
        _: &amp;mut base::Events,
        _: std::time::Duration,
    ) -&gt; anyhow::Result&lt;()&gt; {
        Ok(())
    }
}

fn main() -&gt; anyhow::Result&lt;()&gt; {
    let window = WindowLayerInfo {
        swapchain: SwapchainInfo {
            present_mode: PresentModeKHR::FIFO,
            ..Default::default()
        },
        ..Default::default()
    };

    App::builder()
        .try_push_layer(|_, r, _| WindowLayer::new(r, window))?
        .try_push_layer(GameLayer::new)?
        .try_push_layer(|w, r, e| GraphicsLayer::new(w, r, e, FRAMES_IN_FLIGHT))?
        .try_push_layer(|w, r, e| {
            PhysicsLayer::new(
                w,
                r,
                e,
                physics::PhysicsLayerInfo {
                    gravity: Vec3::ZERO.into(),
                    tree_root: (), // Disable collisions
                    debug: false,
                },
            )
        })?
        .build()
        .run()
}
</code></pre></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
    </body>
</html>
